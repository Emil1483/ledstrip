name: E2E Tests with Cypress

on:
  push:

jobs:
  e2e-tests:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v3

      - name: Docker Compose
        uses: hoverkraft-tech/compose-action@v2.0.2
        with:
          compose-file: compose.yml
        env:
          TAG: ${{ github.sha }}      
          CLERK_SECRET_KEY: ${{ secrets.CLERK_SECRET_KEY }} 
      
      - name: Cypress run
        uses: cypress-io/github-action@v6
        with:
          working-directory: ./client
        env:
          BASE_URL: "http://127.0.0.1:1112"
          CYPRESS_TEST_USER_EMAIL: emil@djupvik.dev
          CYPRESS_TEST_USER_PASSWORD: ${{ secrets.TEST_USER_PASSWORD }}
